<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9">
    <!--[if IE]>
    <script type="text/javascript">
    window.location = "redirect.html";
    </script>
    <![endif]-->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="World" content="">

    <title>World</title>
    <link rel="shortcut icon" type="image/png" href="favicon.png" />

    <!-- Bootstrap Core CSS -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="assets/css/bootstrap-custom.css" rel="stylesheet">

    <!-- JQuery/JQueryUI  -->
    <script src="assets/js/jquery.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css"
        integrity="sha384-/rXc/GQVaYpyDdyxK+ecHPVYJSN9bmVFBvjA/9eOB+pb3F2w2N6fc5qB9Ew5yIns" crossorigin="anonymous">

    <!-- Mapbox GL -->
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.0.0/mapbox-gl.css' rel='stylesheet' />

    <!-- Turf -->
    <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js'></script>

    <!-- Layer Tree Plugin -->
    <script src='assets/plugins/layerTree/js/layer-tree.js'></script>
    <link href='assets/plugins/layerTree/dist/css/styles.min.css' rel='stylesheet' />
    <link href='assets/plugins/layerTree/dist/css/layer-tree-group-settings.css' rel='stylesheet' />

    <!-- Mapbox GL Draw API -->
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.4/mapbox-gl-draw.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.4/mapbox-gl-draw.css'
        type='text/css' />

    <!-- Mapbox GL Geocoder API -->
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.0.1/mapbox-gl-geocoder.js'></script>
    <link rel='stylesheet'
        href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.0.1/mapbox-gl-geocoder.css'
        type='text/css' />

    <!-- Layer Search -->
    <link href="assets/plugins/jsonSearch/chosen/chosen.css" rel="stylesheet">
    <script src="assets/plugins/jsonSearch/layerSearch.js"></script>

    <!-- JQuery UI -->
    <link rel="stylesheet" href="assets/jquery-ui/jquery-ui.min.css" type="text/css">
    <script src="assets/jquery-ui/jquery-ui.js"></script>

    <!-- Misc. CSS -->
    <link href='assets/css/styles-custom.css' rel='stylesheet' />
    <link href='assets/css/text-editor-style.css' rel='stylesheet' />

    <style>
        #map {
            position: absolute;
            top: 50px;
            bottom: 0;
            width: 100%;
        }

        /*mapbox gl css override*/
        .mapboxgl-ctrl-group {
            border-radius: 0px;
            -moz-box-shadow: none;
            -webkit-box-shadow: none;
            box-shadow: none;
            overflow: hidden;
            background: #fff;
        }

        .mapboxgl-ctrl-bottom-left .mapboxgl-ctrl {
            margin: 0 0 10px 65px;
            float: left;
        }

        .mapboxgl-ctrl-group:not(:empty) {
            -moz-box-shadow: 0 0 0px rgba(0, 0, 0, 0.1);
            -webkit-box-shadow: 0 0 0px rgba(0, 0, 0, 0.1);
            box-shadow: 0 0 0 0px rgba(0, 0, 0, 0.1);
        }

        .mapboxgl-ctrl-group>button+button {
            border-top: 0;
        }
    </style>

</head>

<body>

    <script>
        // initial load screen script
        $(window).load(function () {
            $(".se-pre-con").delay(2000).fadeOut(700);
        });
    </script>

    <script>
        document.addEventListener('touchmove', function (e) {
            e.preventDefault();
        }, { passive: false });
    </script>


    <!--initial load screen 
    <div class="se-pre-con">
        <h2 style="text-align: center; margin-top:20%; color: white">
            <i class="fa fa-cog fa-spin"></i>&nbsp;+&nbsp;<i class="fa fa-globe"></i>&nbsp;=&nbsp;<i
                class="fas fa-grin-hearts"></i>
        </h2>
    </div>
-->

    <div class="se-pre-con">
        <h2 style="text-align: center; margin-top:20%; color: white">
            <i class="fas fa-flask"></i>&nbsp;+&nbsp;<i class="fab fa-js-square"></i>&nbsp;=&nbsp;<i
                class="far fa-tired"></i>
        </h2>
    </div>


    <div id="wrapper">
        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a style="display: inline-flex" class="navbar-brand"><i class="fa fa-globe"></i>&nbsp;World</a>
            </div>

            <!-- Top Menu Items -->
            <ul class="nav navbar-right top-nav">

                <!-- Bookmarks -->
                <!-- Bookmarks -->
                <!-- Bookmarks -->
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Bookmarks"><i
                            class="fa fa-bookmark"></i><b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a id="icelandBookmark"><i class="fa fa-fw fa-map-marker"></i> Iceland</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a id="safricaBookmark"><i class="fa fa-fw fa-map-marker"></i> S. Africa</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a id="japanBookmark"><i class="fa fa-fw fa-map-marker"></i> Japan</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a id="australiaBookmark"><i class="fa fa-fw fa-map-marker"></i> Australia</a>
                        </li>
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" title="Contact"><i
                            class="fa fa-question-circle"></i><b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="mailto:email@email.com?subject=email"><i class="fa fa-fw fa-envelope"></i> Contact
                                Us</a>
                        </li>

                        <li class="divider"></li>

                        <li>
                            <a class="clickable" data-toggle="modal" data-target="#disclaimerModal"><i
                                    class="fa fa-fw fa-gavel"></i> Disclaimer</a>
                        </li>
                    </ul>
                </li>
            </ul>

            <!-- Sidebar Menu Tools -->
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav side-nav">

                    <li>
                        <!-- Layer List Button -->
                        <a class="clickable" data-toggle="modal" data-target="#layersModal" title="Layer List"><i
                                class="fa fa-fw fa-list" id="list-load"></i></a>
                    </li>

                    <li>
                        <!-- Layer Attributes -->
                        <a class="clickable" data-toggle="modal" data-target="#attributesModal"
                            title="Layer's Attributes"><i class="fa fa-fw fa-info"></i></a>
                    </li>

                    <li>
                        <!-- Draw Button -->
                        <a class="clickable" data-toggle="modal" data-target="#drawModal" title="Draw & Measure"><i
                                class="fas fa-fw fa-pencil-alt"></i></a>
                    </li>

                    <li>
                        <!-- Coordinates/Address Button -->
                        <a class="clickable" data-toggle="modal" data-target="#geolocationModal"
                            title="Search Address & Coords."><i class="fas fa-fw fa-map-marker-alt"></i></a>
                    </li>

                    <li>
                        <!-- Search Button -->
                        <a class="clickable" data-toggle="modal" data-target="#searchModal"
                            title="Search Address & Coords."><i class="fas fa-binoculars"></i></a>
                    </li>

                    <li>
                        <!-- Make file Button -->
                        <a class="clickable" , data-toggle="modal" data-target="#SaveModal"
                            title="Save data into a geojson file"><i class="fas fa-save"></i></a>
                    </li>

                    <li>
                        <!--Upload data button-->
                        <a class="clickable" , data-toggle="modal" data-target="#UploadModal"
                        title="Upload geojson file"><i class="fas fa-upload"></i></a>
                    </li>

                    <li>
                        <!-- Bbox Button -->
                        <a class="clickable" data-toggle="modal" data-target="#BoundingModal"
                            title="Display Bounding Box"><i class="fas fa-vector-square"></i></a>
                    </li>

                    <li>
                        <!-- Cities Button -->
                        <a class="clickable" data-toggle="modal" data-target="#CityModal" title="Find city"><i
                                class="fas fa-city"></i></a>
                    </li>


                    <li>
                        <!-- Print Map Button -->
                        <a class="stop-print-click" id='mapboxgl-ctrl-print' data-toggle='modal'
                            data-target='#map-print-modal' title="Print Map"><i class="fa fa-fw fa-print"></i></a>
                    </li>

                    <li>
                        <!-- Railroads Button -->
                        <a class="clickable" data-toggle='modal' data-target='#RailroadModal' title="Show railroads"><i
                                class="fas fa-train"></i></a>
                    </li>

                    <li>
                        <!-- Neighbors Button -->
                        <a class="clickable" data-toggle='modal' data-target='#NeighborsModal'
                            title="Show Neighbors "><i class="fas fa-users"></i></a>
                    </li>
                </ul>
            </div>
        </nav>

        <!-- Start Modals - Tool Panels -->
        <!-- Start Modals - Tool Panels -->
        <!-- Start Modals - Tool Panels -->
        <!-- Layer List Modal -->
        <!-- Layer List Modal -->
        <!-- Layer List Modal -->
        <div class="modal left fade" id="layersModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">

                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-list"></i>&nbsp;Layers</h4>
                    </div>

                    <div class="modal-body">

                        <div id="menu"></div>

                    </div>

                </div>
            </div>
        </div>

        <!-- Attributes Modal -->
        <!-- Attributes Modal -->
        <!-- Attributes Modal -->
        <div class="modal left fade" id="attributesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-info"></i>&nbsp;Layer Attributes
                        </h4>
                    </div>

                    <div class="modal-body">

                        <div>
                            <div style="font-size:xx-small; margin:0"><i style="color:#dc4f4f"
                                    class="fa fa-fw fa-exclamation-circle"></i> Select a layer on the map to display
                                attributes...</div>
                            <div style="font-size: 12px" id="layer-attribute"></div>
                        </div>


                    </div>
                </div>
            </div>
        </div>

        <!-- Draw Modal -->
        <!-- Draw Modal -->
        <!-- Draw Modal -->
        <div class="modal left fade" id="drawModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-pencil-alt"></i>&nbsp;Draw Tools
                        </h4>
                    </div>

                    <div class="modal-body">

                        <hr>
                        <br />

                        <p style="font-size: 12px"><i class="fas fa-draw-polygon"></i> Use the Draw tools to create
                            mark-ups on the map.</p>
                        <div id="drawAppend"></div>

                        <div style="display: flex; flex-direction: row">
                            <div id='customDrawColor' style="padding-top: 7px;"></div>
                        </div>

                        <br />
                        <hr>
                        <br />

                        <p style="font-size: 12px"><i class="fas fa-ruler"></i> Use the Draw tools above to calculate
                            area and distance.</p>

                        <p style="font-size: 12px; margin: 0;">area:</p>
                        <div id='calculated-area'> </div>

                        <p style="font-size: 12px; margin: 0;">length/perimeter:</p>
                        <div id='calculated-length'></div>

                        <div style="display: inline-flex">
                            <i style="font-size:smaller; margin: 5px 4px 0px 4px;"><input type="radio" name="unit"
                                    id="feet" value="feet" checked="checked" /> ft &nbsp;</i>
                            <i style="font-size:smaller; margin: 5px 4px 0px 4px;"><input type="radio" name="unit"
                                    id="meter" value="meter" /> m &nbsp;</i>
                            <i style="font-size:smaller; margin: 5px 4px 0px 4px;"><input type="radio" name="unit"
                                    id="mile" value="mile" /> mi &nbsp;</i>
                            <i style="font-size:smaller; margin: 5px 4px 0px 4px;"><input type="radio" name="unit"
                                    id="kilometer" value="kilometer" /> km &nbsp;</i>
                            <i style="font-size:smaller; margin: 5px 0px 0px 4px;"><input type="radio" name="unit"
                                    id="acre" value="acre" /> acres &nbsp;</i>
                        </div>


                        <br />
                        <hr style="margin-top: 15px">
                        <br />

                        <!--Text Tool-->
                        <p style="font-size: 12px"><i class="fas fa-align-left"></i> Add and edit text on the map:</p>

                        <div style="display: inline-flex; width: 100%">
                            <button id="textTool" active='false' onclick="activateTool(this)"><i
                                    class="fa fa-fw fa-plus"></i> Add Text</button>
                            <button id="editTextTool" active='false' onclick="activateTool(this)"><i
                                    class="fa fa-fw fa-edit"></i> Edit Text</button>
                        </div>

                        <br />

                        <div style="display: inline-flex; width: 100%; padding-top: 8px">
                            <div id='customTextColor' style="padding-top: 7px;"></div>
                            <div id='customTextSize'
                                style="padding-left: 10px; font-family: 'Times New Roman', Times, serif;"></div>
                        </div>

                        <br />
                        <hr style="margin-top: 10px; margin-bottom: 10px">

                    </div>
                </div>
            </div>
        </div>

        <!-- Search Modal -->
        <!-- Search Modal -->
        <!-- Search Modal -->
        <div class="modal left fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-search"></i>&nbsp;Search Tools
                        </h4>
                    </div>

                    <div class="modal-body">
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 1. Pick
                            searchable layer...</p>
                        <select class="layer-picker" id="json_layer" data-placeholder="Layer Picker"></select>
                        <br />
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 2. Start
                            searching...</p>
                        <p style="margin-bottom: -1px; padding: 5px 5px 5px 5px; width: 100%; background-color: #fafafa; color: #528ea7; font-size: smaller; "
                            id="property-descr"><br /></p>
                        <div style="display: inline-flex;" id="target_layer">
                            <input type="search" id="general_search" placeholder="Properties" />
                            <input type="hidden" id="property-value"><br />
                            <button class="clickable" type="submit" id="search_general"><i
                                    class="fa fa-search"></i></button>
                            <button class="clickable" type="submit" id="clear_general"><i
                                    class="fa fa-eraser"></i></button>
                        </div>

                        <script>
                            //Allows user to hit enter to search for json property
                            $("#general_search").keyup(function (event) {
                                if (event.keyCode == 13) {
                                    $("#search_general").click();
                                }
                            });
                        </script>

                    </div>
                </div>
            </div>
        </div>

        <!-- Make Json Modal -->
        <!-- Make Json Modal -->
        <!-- Make Json Modal -->
        <div class="modal left fade" id="SaveModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fas fa-save"></i>&nbsp;Save points.
                        </h4>
                    </div>

                    <div class="modal-body">
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 1. Use the
                            search
                            modal to find some points, or just add them yourself.</p>
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 2. The points
                            will
                            be here. Press the save icon to make a Json file from them.</p>

                        <div style="display: inline-flex;" id="target_layer">
                            <textarea id="geocoords"></textarea>
                            <button class="clickable" type="submit" id="save_info"><i class="fas fa-save"></i></button>
                            <button class="clickable" type="submit" id="delete_info"><i
                                    class="fas fa-trash"></i></button>
                        </div>

                        <script>
                            $("#save_info").click(function event(){

                                var dict = {coordinates: "data"}

                                dict[coordinates] = $("#geocoords").html();

                                $.ajax({
                                    type: "POST",
                                    url: "http://127.0.0.1:8080/geodata", 
                                    data: JSON.stringify(dict),
                                    crossDomain: true,
                                    contentType: "application/json"
                                })
                            });

                            $("#delete_info").click(function event(){
                                $("#geocoords").val("");

                            })

                        </script>

                    </div>
                </div>
            </div>
        </div>

        <!-- Upload data Modal -->
        <!-- Upload data Modal -->
        <!-- Upload data Modal -->
        <div class="modal left fade" id="UploadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fas fa-upload"></i>&nbsp;Show points.
                        </h4>
                    </div>

                    <div class="modal-body">
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 1. Paste some geojson
                        data into the textbox below. Press search to show it on the map.</p>

                        <div style="display: inline-flex;" id="target_layer">
                            <textarea id="geojsondata"></textarea>
                            <button class="clickable" type="submit" id="uploadData"><i class="fas fa-search"></i></button>
                            <button class="clickable" type="submit" id="deleteData"><i
                                    class="fas fa-trash"></i></button>
                        </div>

                        <script>
                            $("#uploadData").click(function (event){

                                let userdata = $("#geojsondata").val()
                                console.log(userdata)
                                userdata = JSON.parse(userdata)

                                let name = 'textdata' + 1;

                                map.addSource(name, {
                                    type: 'geojson',
                                    data: userdata
                                });

                                map.addLayer({
                                    id: name,
                                    type: 'circle',
                                    source: name,
                                    paint: {
                                        "circle-color": "blue",
                                        "circle-radius": 5,
                                    }
                                });

                            });

                            $("#deleteData").click(function (event){
                                $("#geojsondata").val("")
                            })


                        </script>
                    </div>
                </div>
            </div>
        </div>
        <!-- City Modal -->
        <!-- City Modal -->
        <!-- City Modal -->
        <div class="modal left fade" id="CityModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fa fa-fw fa-search"></i>&nbsp; Search Cities
                        </h4>
                    </div>

                    <div class="modal-body">

                        <!--Header for first textbox-->
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 1: Pick City.
                        </p>
                        <br />

                        <!--Search bar and stuff-->
                        <div style="display: inline-flex;" id="target_layer">
                            <input type="search" id="pickCity" placeholder="City" />
                            <button class="clickable" type="submit" id="search_city"><i
                                    class="fa fa-search"></i></button>
                            <button class="clickable" type="submit" id="clear_city"><i
                                    class="fa fa-eraser"></i></button>
                        </div>

                        <select class="city-picker" id="city-select">
                        </select>

                        <br />
                        <!-- Ending city -->

                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 2: Pick Ending
                            City.</p>
                        <br />
                        <div style="display: inline-flex;" id="target_layer">
                            <input type="search" id="pickCity2" placeholder="City" />
                            <button class="clickable" type="submit" id="search_city2"><i
                                    class="fa fa-search"></i></button>
                            <button class="clickable" type="submit" id="clear_city2"><i
                                    class="fa fa-eraser"></i></button>
                        </div>

                        <select class="city-picker2" id="city-select2">
                        </select>

                        <br />
                        <!--Lon lat for city 1-->
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />City 1 Lon Lat</p>
                        <br />
                        <input type="search" id="City1coords" />

                        <br />
                        <!--Lon lat for city 2-->
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />City 2 Lon Lat</p>
                        <br />
                        <input type="search" id="City2coords" />


                        <!-- Final box to calculate distance between cities-->
                        <br />
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Step 3: Find
                            distance between cities!</p>
                        <br />

                        <div style="display: inline-flex;" id="target_layer">
                            <input type="search" id="distance" />
                            <button class="clickable" type="submit" id="getdist"><i class="fa fa-road"></i></button>
                        </div>


                        <script>

                            $("#city-select").hide();
                            $("#city-select2").hide();

                            // Remove the choices when a choice is selected
                            $("#clear_city").click(function (event) {
                                $("#pickCity").val("");
                                $("#city-select").html("");
                                $("#city-select").hide();
                            });

                            $("clear_city2").click(function (event) {
                                $("#pickCity2").val("");
                                $("#city-select2").html("");
                                $("#city-select2").hide();
                            });

                            // When the search button is clicked, find the coordinates
                            // for that city.
                            $("#search_city").click(function (event) {
                                let city = $("#pickCity").val();

                                $.get("http://localhost:8080/cities?filter=" + city, function (data) {
                                    let coords = data['results'][0].geometry.coordinates;

                                    console.log(coords);
                                    $("#City1coords").val(coords);

                                    var lon = coords[0]
                                    var lat = coords[1]

                                    var enterLL = turf.point([lon, lat]);

                                    // Adds the city to the map
                                    map.addSource('enterLL', {
                                        type: 'geojson',
                                        data: enterLL
                                    });

                                    // Adds a marker to city
                                    map.addLayer({
                                        id: 'enterLL',
                                        type: 'circle',
                                        source: 'enterLL',
                                        layout: {

                                        },


                                        paint: {
                                            "circle-color": 'red',
                                            "circle-radius": 8,
                                        },
                                    });

                                    // Flies to city
                                    map.flyTo({
                                        center: [lon, lat]
                                    });
                                });
                            });

                            // When the search button is clicked, find the coordinates
                            // for that city.
                            $("#search_city2").click(function (event) {
                                let city = $("#pickCity2").val();

                                $.get("http://localhost:8080/cities?filter=" + city, function (data) {
                                    let coords = data['results'][0].geometry.coordinates;

                                    console.log(coords);
                                    $("#City2coords").val(coords);

                                    var lon = coords[0]
                                    var lat = coords[1]

                                    var enterLL2 = turf.point([lon, lat]);

                                    // Adds the city to the map
                                    map.addSource('enterLL2', {
                                        type: 'geojson',
                                        data: enterLL2
                                    });

                                    // Adds a marker to city
                                    map.addLayer({
                                        id: 'enterLL2',
                                        type: 'circle',
                                        source: 'enterLL2',
                                        layout: {

                                        },


                                        paint: {
                                            "circle-color": 'blue',
                                            "circle-radius": 8,
                                        },
                                    });

                                    // Flies to city
                                    map.flyTo({
                                        center: [lon, lat]
                                    });
                                });
                            });

                            // For when user clicks on a selection
                            $("#city-select").click(function (event) {
                                let city = $("#city-select option:selected").text();

                                $("#pickCity").val(city)

                                $("#city-select").hide();
                            });


                            // For when user clicks on a selection for second city
                            $("#city-select2").click(function (event) {
                                let state = $("#city-select2 option:selected").text();

                                $("#pickCity2").val(state)

                                $("#city-select2").hide();
                            });

                            // Fill in textbar with cities
                            $("#pickCity").keyup(function (event) {
                                populateCitySelect();
                            });

                            // Same but with cities 2
                            $("#pickCity2").keyup(function (event) {
                                populateCitySelect2();
                            });

                            // Used to populate the bar full of cities
                            function populateCitySelect() {
                                let filter = $("#pickCity").val();

                                let html = "";

                                let count = 0;

                                $("#city-select").show();
                                $.get("http://localhost:8080/cities?filter=" + filter, function (data) {
                                    if (data['count'] > 15) {
                                        count = 15;
                                    }

                                    else {
                                        count = data['count']
                                    }

                                    for (var i = 0; i < count; i++) {
                                        html += '<option>' + data['results'][i].properties.name + '</option>';
                                    }

                                    $('#city-select').attr("size", count);
                                    $('#city-select').html(html);

                                });
                            };

                            function populateCitySelect2() {
                                let filter = $("#pickCity2").val();

                                let html = "";

                                let count = 0;

                                $("#city-select2").show();
                                $.get("http://localhost:8080/cities?filter=" + filter, function (data) {
                                    if (data['count'] > 15) {
                                        count = 15;
                                    }

                                    else {
                                        count = data['count']
                                    }

                                    for (var i = 0; i < count; i++) {
                                        html += '<option>' + data['results'][i].properties.name + '</option>';
                                    }

                                    $('#city-select2').attr("size", count);
                                    $('#city-select2').html(html);

                                });
                            };

                            // This will draw a line between the two cities.
                            $("#getdist").click(function (event) {

                                // Grab the value in these two elements
                                // and put them in coord variables.
                                // Note: These are actually strings.
                                // we need to convert them into floats.
                                let coords = $("#City1coords").val();
                                let coords2 = $("#City2coords").val();

                                // First make an array from the string.
                                coords = coords.split(',');
                                coords2 = coords2.split(',')

                                // Pick off each value and put it in
                                // a lon/lat variable.
                                let lon = parseFloat(coords[0]);
                                let lat = parseFloat(coords[1]);
                                let lon2 = parseFloat(coords2[0]);
                                let lat2 = parseFloat(coords2[1]);


                                var positions = [
                                    [lon, lat],
                                    [lon2, lat2]
                                ];

                                var linestring = turf.lineString(positions);

                                map.addLayer({
                                    'id': 'distance',
                                    'type': 'line',
                                    'source': {
                                        'type': "geojson",
                                        "data": linestring
                                    },
                                    'layout': {
                                        'line-join': 'round',
                                        'line-cap': 'round'
                                    },
                                    'paint': {
                                        'line-color': '#FF0',
                                        'line-width': 6
                                    }
                                });

                                // Do haversine while we're here.
                                var PI = Math.PI;
                                let AVG_EARTH_RADIUS = 6371;

                                // Convert lats and lons to radians
                                lon = lon * (PI / 180);
                                lat = lat * (PI / 180);
                                lon2 = lon2 * (PI / 180);
                                lat2 = lat2 * (PI / 180);

                                let tlon = lon2 - lon;
                                let tlat = lat2 - lat;

                                let distance = Math.sin(tlat * 0.5) ** 2 + Math.cos(lat) * Math.cos(lat2) * Math.sin(tlon * 0.5) ** 2;
                                let h = 2 * AVG_EARTH_RADIUS * Math.asin(Math.sqrt(distance));

                                let haversine = h * 0.621371;

                                let Hvalue = haversine.toString() + "mi";

                                $("#distance").val(Hvalue);

                            });

                        </script>

                    </div>
                </div>
            </div>
        </div>

        <!-- Neighbors Modal-->
        <!-- Neighbors Modal-->
        <!-- Neighbors Modal-->
        <div class="modal left fade" id="NeighborsModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fas fa-users"></i>&nbsp;Show Closest
                            Neighbors.
                        </h4>
                    </div>

                    <div class="modal-body">

                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br /> Click on the map to select 
                            a pair of coordiantes.</p>
                        <br />

                        <pre id="clickedCoords" ></pre>
                        <br />
                        
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br /> Select the number of volcanos 
                            you wish to find.</p>

                        <input type="search" id="neighbornum" />
                        <br />

                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br /> When the above data is correct,
                            press the button below.</p>

                        <button class="clickable" type="submit" id="findNeighbors"><i class="fa fa-search"></i></button>

                        <script>

                            $("#findNeighbors").click(function (event) {
                                let coords = $("#clickedCoords").html()

                                coords = coords.split(',');

                                let lon = parseFloat(coords[0]);
                                let lat = parseFloat(coords[1]);

                                console.log(lon)
                                console.log(lat)

                                let number = $("#neighbornum").val()
                                console.log(number)

                                $.get("http://localhost:8080/neighbors?lon=" + lon + "&lat=" + lat + "&num=" + number, function(data){
                                    let features = data['results'][0]['features'];

                                    for(i=0;i<number;i++)
                                    {
                                        let coords = (features[i].geometry.coordinates)

                                        var marker = new mapboxgl.Marker({'color':"#FFFF00"})
                                        .setLngLat(coords)
                                        .addTo(map);
                                    }
                                })
                            });
                        </script>

                    </div>

                </div>

            </div>
        </div>

        <!-- Bbox Modal -->
        <!-- Bbox Modal -->
        <!-- Bbox Modal -->
        <div class="modal left fade" id="BoundingModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fas fa-vector-square"></i>&nbsp;Display
                            Bounding
                            Box</h4>
                    </div>

                    <div class="modal-body">
                        <p>Click on the button below, then click some points on the map.</p>
                        <button class="clickable" type="submit" id="Draw-shape"><i
                                class="fas fa-map-marker"></i></button>

                        <br />

                        <p>Click this stop button when you have entered your points.</p>
                        <button class="clickable" type="submit" id="StopDraw"><i class="fas fa-square"></i></button>
                        <br />

                        <p>After hitting the stop button, click this button to make your box.</p>
                        <button class="clickable" type="submit" id="Make-shape"><i
                                class="fas fa-vector-square"></i></button>
                        <br />

                        <p>This button will show all the cities within your box.</p>
                        <button class="clickable" type="submit" id="ShowPoints"><i class="fas fa-city"></i></button>


                        <script>

                            var points = [];
                            var done = false;
                            //var markernum = 0;

                            // Lets the user click on the map and add their points.
                            $("#Draw-shape").click(function (event) {

                                map.on('click', function (e) {
                                    if (done == false) {
                                        let coords = e.lngLat;

                                        points.push(coords);

                                        console.log(points);

                                        var marker = new mapboxgl.Marker()
                                            .setLngLat(coords)
                                            .addTo(map);

                                    }
                                });

                            });

                            // Used to make sure we don't add anymore of the user's points
                            // to the map.
                            $("#StopDraw").click(function (event) {
                                done = true;
                            });

                            // Will let the user create their bounding box.
                            $("#Make-shape").click(function (event) {
                                console.log(points.length);

                                for (i = 0; i < points.length - 1; i++) {
                                    let lng1 = points[i].lng;
                                    let lat1 = points[i].lat;
                                    let lng2 = points[i+1].lng;
                                    let lat2 = points[i+1].lat;
                                    let positions = [[lng1, lat1],[lng2, lat2]];

                                    console.log(positions);
                                    
                                    var linestring = turf.lineString(positions);

                                    name = "path" + i;

                                        map.addLayer({
                                            'id': name,
                                            'type': 'line',
                                            'source': {
                                                'type': "geojson",
                                                "data": linestring
                                            },
                                            'layout': {
                                                'line-join': 'round',
                                                'line-cap': 'round'
                                            },
                                            'paint': {
                                                'line-color': '#FF0',
                                                'line-width': 6
                                            }
                                        });
                                };

                                // Make the last line
                                let last = points.length - 1;

                                    let lng1 = points[last].lng;
                                    let lat1 = points[last].lat;
                                    let lng2 = points[0].lng;
                                    let lat2 = points[0].lat;
                                    let positions = [[lng1, lat1],[lng2, lat2]];

                                    console.log(positions);
                                    
                                    var linestring = turf.lineString(positions);

                                    name = "lastpath";

                                    map.addLayer({
                                            'id': name,
                                            'type': 'line',
                                            'source': {
                                                'type': "geojson",
                                                "data": linestring
                                            },
                                            'layout': {
                                                'line-join': 'round',
                                                'line-cap': 'round'
                                            },
                                            'paint': {
                                                'line-color': '#FF0',
                                                'line-width': 6
                                            }
                                        });
                            });

                            $("#ShowPoints").click(function (event) {

                                // First find the max and min lats and longs
                                // Get the max lats and lons
                                let lonmax = points[0].lng;
                                let latmax = points[0].lng;
                                for(i=1; i<points.length; i++)
                                {
                                    if(points[i].lng > lonmax)
                                    {
                                        lonmax = points[i].lng
                                    }

                                    if(points[i].lat > latmax)
                                    {
                                        latmax = points[i].lat
                                    }
                                }

                                // Get the min lats and lons
                                let lonmin = points[0].lng;
                                let latmin = points[0].lat;
                                for(i=1; i<points.length; i++)
                                {
                                    if(points[i].lng < lonmin)
                                    {
                                        lonmin = points[i].lng;
                                    }
                                    
                                    if(points[i].lat < latmin)
                                    {
                                        latmin = points[i].lat;
                                    }
                                }

                                console.log(lonmin)
                                console.log(lonmax)
                                console.log(latmin)
                                console.log(latmax)

                                $.get("http://localhost:8080/cities", function (data){
                                    cities = data["results"][0]['features']

                                    // Loop through every city
                                    for(i=0; i<cities.length; i++)
                                    {
                                        
                                        citylon = parseFloat((cities[i].geometry.coordinates[0]))
                                        citylat = parseFloat((cities[i].geometry.coordinates[1]))
                                        console.log(citylon)
                                        if((citylon > lonmin && citylon < lonmax) && (citylat > latmin && citylat < latmax))
                                        {
                                            coords = [citylon, citylat]
                                            var marker = new mapboxgl.Marker({"color": "#FF4500"})
                                            .setLngLat(coords)
                                            .addTo(map);  
                                        }
                                    }


                                })
                            })


                        </script>

                    </div>
                </div>
            </div>
        </div>

        <!-- Location Modal -->
        <!-- Location Modal -->
        <!-- Location Modal -->
        <div class="modal left fade" id="geolocationModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i
                                class="fas fa-fw fa-map-marker-alt"></i>&nbsp;Location
                            Tools</h4>
                    </div>

                    <div class="modal-body">

                        <hr>
                        <br />

                        <!-- enter lng/lat -->
                        <div style="vertical-align:top;">
                            <p style="font-size: 12px"><i class="fas fa-map-marked-alt"></i> Enter Coordinates</p>
                            <input type="number" id='lngInput' style="font-size: 11px; padding: 2px; margin:2px"
                                placeholder="longitude"><br>
                            <input type="number" id='latInput' style="font-size: 11px; padding: 2px; margin:2px"
                                placeholder="latitude"><br>

                            <div style="padding-top:10px">
                                <input type="button" value="find" id="findLLButton" style="font-size: 10px;">
                                <input type="button" value="clear" id="findLLButtonClear" style="font-size: 10px;">
                            </div>
                        </div>

                        <br />
                        <hr>
                        <br />

                        <!-- lng/lat on map click -->
                        <p style="font-size: 12px"><i class="fas fa-mouse-pointer"></i> Click on map to find lng/lat:
                        </p>
                        <pre id='info'><i class="fa fa-fw fa-globe"></i> lng/lat</pre>

                        <br />
                        <hr>
                        <br />

                        <!-- address geocode api-->
                        <p style="font-size: 12px"><i class="fas fa-home"></i> Address Search:</p>
                        <div id="addressAppend"></div>

                        <br />
                        <hr>
                        <br />

                    </div>
                </div>
            </div>
        </div>



        <!-- Print Modal -->
        <!-- Print Modal -->
        <!-- Print Modal -->
        <div id="map-print-modal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title"><i class="fa fa-fw fa-print"></i>&nbsp;Print Map</h4>
                    </div>

                    <div class="modal-body">

                        <!-- print form -->
                        <form class="form-horizontal container-fluid" id="print-form">
                            <div class="row">

                                <!-- title -->
                                <div class="col">
                                    <div class="form-group col-sm-12">
                                        <label>Map Title:</label>
                                        <input id="export-title" name="export-title" type="text"
                                            style="font-size: smaller" placeholder="Title..."
                                            class="form-control input-md" maxlength="90">
                                    </div>
                                </div>

                                <!-- output format -->
                                <div class="radio-groups format form-group col-sm-12">

                                    <div>
                                        <label>Format: </label>
                                        <label class="radio-inline" for="output-format-0">
                                            <input type="radio" name="output-format" id="output-format-0" value="png">
                                            PNG
                                        </label>
                                        <label class="radio-inline" for="output-format-1">
                                            <input type="radio" name="output-format" id="output-format-1" value="pdf"
                                                checked="checked">
                                            PDF
                                        </label>

                                    </div>
                                </div>
                                <!-- format/dimensions -->
                                <div class="radio-groups size form-group col-sm-12">

                                    <div>
                                        <label>Dimensions: </label>
                                        <label class="radio-inline" for="dimensions-0">
                                            <input type="radio" name="dimensions" id="dimensions-0" value="default"
                                                checked="checked">
                                            8.5 x 11
                                        </label>
                                        <label class="radio-inline" for="dimensions-1">
                                            <input type="radio" name="dimensions" id="dimensions-1" value="large">
                                            11 x 17 (legend)
                                        </label>
                                    </div>
                                </div>

                                <div>
                                    <button type="button" id="export-map" class="button button" data-dismiss="modal"><i
                                            class="fa fa-fw fa-print"></i> Create Map</button>
                                    <div style="padding-top: 13px; font-size:xx-small; margin:0"><i
                                            style="color:#dc4f4f" class="fa fa-fw fa-exclamation-circle"></i> This may
                                        take a few seconds...</div>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>


        <!-- Railroad Modal-->
        <!-- Railroad Modal-->
        <!-- Railroad Modal-->
        <div class="modal left fade" id="RailroadModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"><i class="fas fa-train"></i>&nbsp;Show railroads.
                        </h4>
                    </div>

                    <div class="modal-body">
                        <p style="margin-bottom: -1px; padding: 0px 0px 5px 0px; width: 100%;"><br />Pick a state: its
                            railroads will be shown.</p>
                        <br />
                        <div style="display: inline-flex;" id="target_layer">
                            <input type="search" id="pickState" />
                            <br />
                            <button class="clickable" type="submit" id="search_state"><i
                                    class="fa fa-search"></i></button>
                            <button class="clickable" type="submit" id="clear_state"><i
                                    class="fa fa-eraser"></i></button>
                        </div>

                        <select class="state-picker" id="state-select">
                        </select>

                        <script>

                            $("#state-select").hide();

                            // Remove the choices when a choice is selected
                            $("#clear_state").click(function (event) {
                                $("#pickState").val("");
                                $("#state-select").html("");
                                $("#state-select").hide();
                            });

                            $("#pickState").keyup(function (event) {
                                populateStatesSelect();
                            });

                            // For when user clicks on a selection
                            $("#state-select").click(function (event) {
                                let state = $("#state-select option:selected").text();

                                $("#pickState").val(state)

                                $("#state-select").hide();
                            });

                            $("#search_state").click(function (event) {
                                showrailroads();
                            })

                            function showrailroads() {
                                let filter = $("#pickState").val();

                                $.get("http://localhost:8080/railroads?filter=" + filter, function (data) {
                                    for (var i = 0; i < 300; i++) {

                                        let road = data['results'][i].geometry.coordinates;

                                        let id = "road" + i;
                                        console.log(id);

                                        var linestring = turf.lineString(road);

                                        // Add the road to the map
                                        map.addLayer({
                                            'id': id,
                                            'type': 'line',
                                            'source': {
                                                'type': "geojson",
                                                "data": linestring
                                            },
                                            'layout': {
                                                'line-join': 'round',
                                                'line-cap': 'round'
                                            },
                                            'paint': {
                                                'line-color': '#0F0',
                                                'line-width': 2
                                            }
                                        });
                                    };
                                });
                            };

                        </script>

                    </div>


                </div>
            </div>
        </div>


        <!-- Disclaimer Modal -->
        <!-- Disclaimer Modal -->
        <!-- Disclaimer Modal -->
        <div id="disclaimerModal" class="modal" role="dialog">
            <div class="modal-dialog">

                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title"><i class="fa fa-fw fa-gavel"></i>&nbsp;Disclaimer</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            A place to put your disclaimer... Surely everyone will read it.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Load Map Div -->
        <!-- Load Map Div -->
        <!-- Load Map Div -->
        <div id='map'></div>

        <!-- Load coordinates div (Part of Geolocation Modal)-->
        <div id='coordinates' class='coordinates'></div>

    </div>

    <!-- Print JS and required Libs -->
    <!-- cdn -->
    <!--<script src='https://cdn.rawgit.com/blueimp/JavaScript-Canvas-to-Blob/master/js/canvas-to-blob.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.8.177/pdf.combined.min.js'></script>
    <script src='https://cdn.rawgit.com/eligrey/FileSaver.js/master/FileSaver.min.js'></script>
    <script src='https://cdn.rawgit.com/niklasvh/html2canvas/master/dist/html2canvas.min.js'></script>
    <script src='https://cdn.rawgit.com/fengyuanchen/cropper/master/dist/cropper.min.js'></script>-->
    <!-- local -->
    <script src='assets/plugins/print-export/libs/canvas-to-blob.min.js'></script>
    <script src='assets/plugins/print-export/libs/jspdf.min.js'></script>
    <script src='assets/plugins/print-export/libs/pdf.combined.min.js'></script>
    <script src='assets/plugins/print-export/libs/FileSaver.min.js'></script>
    <script src='assets/plugins/print-export/libs/html2canvas.min.js'></script>
    <script src='assets/plugins/print-export/libs/cropper.min.js'></script>
    <script src='assets/js/print.js'></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="assets/bootstrap/bootstrap.min.js"></script>

    <!-- Leaflet JavaScript -->
    <script src="assets/leaflet/leaflet.js"></script>

    <!-- Map JavaScript -->
    <script src="assets/js/map.js"></script>

    <!-- Search Layer Config -->
    <script src="assets/plugins/jsonSearch/layers.js"></script>

    <!-- Layer Search Scripts -->
    <script src="assets/plugins/jsonSearch/chosen/chosen.jquery.js"></script>

    <script type="text/javascript">
        $("#json_layer").change(function () {
            $("#general_search").val("");
            $("#property-descr").html("<br />");
            var source_name = $('#json_layer').val();
            refreshJsonSource(source_name);
        });
    </script>

</body>

</html>